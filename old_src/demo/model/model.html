<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
	<head>
		<title>Component Tree Controller Example</title>
		<script type='text/javascript' src='../../../steal/steal.js'></script>
		<link rel="stylesheet" type="text/css" href="../../../../../css/table.css">
		<style type='text/css'>
		</style>
	</head>
	<body>
		
<!-- -----------------------------------------------------------------------
												DEMO HTML BLOCK
 -------------------------------------------------------------------------->
<div id="demo-html">
<script id="userProfileEJS" type="text/ejs">
	<h2>User Profile</h2>
	<ul <%= (el) -> el.data('demo.model.Person', item ) %>>
		<li><%= item.attr('name') %></li>
		<li><%= item.attr('surname') %></li>
	</ul>
</script>
<script id="userDetailsEJS" type="text/ejs">	
	<h2>User Details</h2>
	<ul <%= (el) -> el.data('demo.model.Person', item ) %>>
		<li><%= item.attr('name') %></li>
		<li><%= item.attr('surname') %></li>
		<li><%= item.attr('email') %></li>
		<li><%= item.attr('phone') %></li>
	</ul>
</script>
<div id="js_demo_app_controller">
	<div id="js_user_profile"></div>
	<div id="js_user_details"></div>
	<select>
		<option value="name">Change Name</option>
		<option value="surname">Change Surname</option>
		<option value="email">Change Email</option>
		<option value="phone">Change Phone</option>
	</select>
	<input id="name" type="text" />
	<button class="update">update</button>
	<button class="reset">reset</button>
</div>
</div>

<!-- -----------------------------------------------------------------------
												DEMO JAVASCRIPT BLOCK
 -------------------------------------------------------------------------->
<script type='text/javascript'>
steal(
	'mad/demo/init.js'
).then(
	'mad/test/data/model/person.js'
).then(function() {

	mad.controller.ComponentController.extend('demo.controller.component.UserProfile', {
		'defaults': {
			'templateUri': 'userProfileEJS'
		}
	}, {
		'load': function (item) {
			var self = this;
			this.setViewData ('item', item);
			// listen any change on the model
			item.bind('updated', function() {
				// refresh the view
				self.setViewData('item', this);
				self.render();
			});
			return this;
		}
	});
	var userProfileComponent = new demo.controller.component.UserProfile('#js_user_profile', {});

	mad.controller.ComponentController.extend('demo.controller.component.UserDetails', {
		'defaults': {
			'templateUri': 'userDetailsEJS'
		}
	}, {
		'load': function (item) {
			var self = this;
			this.setViewData ('item', item);
			// listen any change on the model
			item.bind('updated', function() {
				// refresh the view
				self.setViewData('item', this);
				self.render();
			});
			return this;
		}
	});
	var userDetailsComponent = new demo.controller.component.UserDetails('#js_user_details', {});

	// get the first person and load the user profile component with it.
	// the first call load the person_1 from the server.
	demo.model.Person.findOne({id: 'person_1'}, function (person, response, request) {
		userProfileComponent.load(person)
			.render();
	}, function (response) {});

	// get the first person and load the user details component with it.
	// the second call load the person_1 from the server, but return an existing instance
	// (updated with data from server) if this one has bind binded by a third party.
	demo.model.Person.findOne({id: 'person_1'}, function (person, response, request) {
		userDetailsComponent.load(person)
			.render();
	}, function (response) {});
	
	// get the first person. This model instance will be used by the following code
	// to update the attributes
	var person_1 = null;
	demo.model.Person.findOne({id: 'person_1'}, function (person, response, request) {
		person_1 = person;
	}, function (response) {});
	
	$('button.update').bind('click', function () {
		var attrName = $('select').val();
		var value = $('input').val();
		person_1.attr(attrName, value);
	});
	
	// reset the instance by loading data from server
	$('button.reset').bind('click', function () {
		demo.model.Person.findOne({id: 'person_1'});
	});
	
});
</script>

	</body>
</html>